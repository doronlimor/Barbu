<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barbu - Card Game</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #062318 0%, #0a4d2e 50%, #0d5c38 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        .game-container { max-width: 1200px; margin: 0 auto; }
        .game-header { text-align: center; padding: 30px; margin-bottom: 30px; border-bottom: 2px solid #d4af37; }
        .game-title { font-size: 3em; color: #d4af37; margin-bottom: 10px; }
        .game-subtitle { font-size: 1.2em; color: #f4e4a6; }
        .message-box {
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.2em;
            border: 2px solid #d4af37;
        }
        .contract-selection {
            background: rgba(0, 0, 0, 0.5);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #d4af37;
        }
        .contract-title { font-size: 1.8em; color: #d4af37; margin-bottom: 20px; text-align: center; }
        .contract-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .contract-button {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.1));
            border: 2px solid #d4af37;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }
        .contract-button:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4);
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.3), rgba(212, 175, 55, 0.2));
        }
        .contract-button:disabled { opacity: 0.3; cursor: not-allowed; }
        .contract-name { font-size: 1.3em; font-weight: bold; margin-bottom: 8px; }
        .contract-description { font-size: 0.9em; color: #f4e4a6; line-height: 1.4; margin-bottom: 8px; }
        .contract-score { font-size: 1.1em; font-weight: bold; color: #dc143c; }
        .game-info {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            border: 2px solid rgba(212, 175, 55, 0.3);
        }
        .info-item { text-align: center; }
        .info-label { font-size: 0.9em; color: #f4e4a6; margin-bottom: 5px; }
        .info-value { font-size: 1.5em; font-weight: bold; color: #d4af37; }
        .bidding-status { background: rgba(0,0,0,0.4); padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .bidding-title { color: #d4af37; margin-bottom: 15px; text-align: center; font-size: 1.3em; }
        .bidding-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .bidder-card {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid transparent;
            text-align: center;
        }
        .bidder-card.active { background: rgba(212, 175, 55, 0.2); border-color: #d4af37; }
        .bidder-name { font-weight: bold; margin-bottom: 8px; color: #d4af37; }
        .bidder-status { font-size: 0.9em; }
        .action-buttons { display: flex; gap: 15px; justify-content: center; margin-top: 20px; }
        .action-button {
            background: linear-gradient(135deg, #d4af37, #c09a2e);
            border: none;
            border-radius: 10px;
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            color: #062318;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
        }
        .action-button:hover { transform: translateY(-3px); box-shadow: 0 6px 25px rgba(212, 175, 55, 0.6); }
        .action-button.double { background: linear-gradient(135deg, #ff8844, #ff4444); }
        .action-button.redouble { background: linear-gradient(135deg, #ff4444, #cc0000); }
        .game-board {
            display: grid;
            grid-template-areas: 
                "opponent2 opponent2 opponent2"
                "opponent1 center opponent3"
                "player player player";
            gap: 20px;
            margin-bottom: 30px;
        }
        .player-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(212, 175, 55, 0.2);
        }
        .player-area.active { border-color: #d4af37; box-shadow: 0 0 30px rgba(212, 175, 55, 0.5); }
        .player-area.dealer { border-color: #4169e1; box-shadow: 0 0 20px rgba(65, 105, 225, 0.4); }
        .player-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .player-name { font-size: 1.3em; font-weight: bold; color: #d4af37; }
        .dealer-badge {
            background: #4169e1;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.7em;
            margin-left: 10px;
        }
        .player-score { font-size: 1.8em; font-weight: bold; color: #f4e4a6; }
        .cards-container { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; min-height: 140px; }
        .card {
            width: 70px;
            height: 100px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }
        .card:hover { transform: translateY(-10px); }
        .card.playable { border-color: #32cd32; box-shadow: 0 0 15px rgba(50, 205, 50, 0.5); }
        .card.red { color: #dc143c; }
        .card.black { color: #1a1a1a; }
        .card-rank { font-size: 1.5em; font-weight: bold; margin-bottom: 5px; }
        .card-suit { font-size: 1.8em; }
        .card-back {
            width: 70px;
            height: 100px;
            background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.2);
            font-size: 2.5em;
        }
        .trick-area { grid-area: center; display: flex; align-items: center; justify-content: center; min-height: 200px; }
        .trick-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            border: 3px dashed rgba(212, 175, 55, 0.3);
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal {
            background: linear-gradient(135deg, #062318, #0a4d2e);
            padding: 40px;
            border-radius: 20px;
            border: 3px solid #d4af37;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9);
        }
        .modal h2 { font-size: 2.5em; color: #d4af37; margin-bottom: 20px; text-align: center; }
        .score-table table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .score-table th, .score-table td { padding: 12px; text-align: center; border-bottom: 1px solid rgba(212, 175, 55, 0.2); }
        .score-table th { background: rgba(212, 175, 55, 0.2); color: #d4af37; font-weight: bold; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1 class="game-title">Barbu</h1>
            <div class="game-subtitle">Classic Four-Player Card Game</div>
        </div>
        <div id="message" class="message-box">Loading game...</div>
        <div id="contractSelection" class="contract-selection hidden"></div>
        <div id="biddingPhase" class="hidden"></div>
        <div id="gamePlay" class="hidden"></div>
        <div id="gameOver" class="modal-overlay hidden"></div>
    </div>
    <script>
        const gameState = {
            state: 'initial',
            round: 1,
            dealer: 0,
            currentPlayer: 0,
            selectedContract: null,
            usedContracts: [[], [], [], []],
            players: [
                { name: 'You', cards: [], score: 0, tricks: 0 },
                { name: 'Player 2', cards: [], score: 0, tricks: 0 },
                { name: 'Player 3', cards: [], score: 0, tricks: 0 },
                { name: 'Player 4', cards: [], score: 0, tricks: 0 }
            ],
            currentTrick: [],
            trumpSuit: null,
            trickNumber: 0,
            bidding: {
                doubles: [false, false, false, false],
                redoubles: [false, false, false, false],
                currentBidder: null,
                complete: false
            }
        };
        const SUITS = {
            HEARTS: { symbol: '♥', name: 'Hearts', color: 'red' },
            DIAMONDS: { symbol: '♦', name: 'Diamonds', color: 'red' },
            CLUBS: { symbol: '♣', name: 'Clubs', color: 'black' },
            SPADES: { symbol: '♠', name: 'Spades', color: 'black' }
        };
        const CONTRACTS = {
            NO_TRICKS: { name: 'No Tricks', description: 'Each trick = -2 points', score: -26 },
            NO_HEARTS: { name: 'No Hearts', description: 'Each heart = -2, Ace = -6', score: -30 },
            NO_QUEENS: { name: 'No Queens', description: 'Each queen = -6 points', score: -24 },
            BARBU: { name: 'Barbu', description: 'King of hearts = -20 points', score: -20 },
            LAST_TWO: { name: 'Last Two', description: 'Trick 12 = -10, Trick 13 = -20', score: -30 },
            TRUMPS: { name: 'Trumps', description: 'Each trick = +5 points', score: 65 },
            DOMINO: { name: 'Domino', description: '1st +45, 2nd +20, 3rd +5, 4th -5', score: 65 }
        };
        function createDeck() {
            const deck = [];
            const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
            for (let suit in SUITS) {
                for (let rank of ranks) {
                    deck.push({ suit, rank, id: `${rank}_${suit}` });
                }
            }
            return shuffleDeck(deck);
        }
        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }
        function dealCards() {
            const deck = createDeck();
            for (let i = 0; i < 4; i++) {
                gameState.players[i].cards = deck.slice(i * 13, (i + 1) * 13);
                gameState.players[i].tricks = 0;
            }
        }
        function showMessage(msg) {
            document.getElementById('message').textContent = msg;
            document.getElementById('message').classList.remove('hidden');
        }
        function hideAllSections() {
            document.getElementById('contractSelection').classList.add('hidden');
            document.getElementById('biddingPhase').classList.add('hidden');
            document.getElementById('gamePlay').classList.add('hidden');
        }
        function startRound() {
            dealCards();
            gameState.currentTrick = [];
            gameState.trickNumber = 0;
            gameState.state = 'contract-selection';
            if (gameState.dealer === 0) {
                showContractSelection();
            } else {
                showMessage(`Waiting for ${gameState.players[gameState.dealer].name} to select contract...`);
                setTimeout(() => aiSelectContract(), 2000);
            }
        }
        function showContractSelection() {
            hideAllSections();
            showMessage(`Round ${gameState.round} - Choose your contract`);
            const container = document.getElementById('contractSelection');
            container.classList.remove('hidden');
            container.innerHTML = '<h2 class="contract-title">Choose Contract</h2><div class="contract-grid" id="contractGrid"></div>';
            const grid = document.getElementById('contractGrid');
            for (let key in CONTRACTS) {
                const contract = CONTRACTS[key];
                const button = document.createElement('button');
                button.className = 'contract-button';
                button.disabled = gameState.usedContracts[gameState.dealer].includes(key);
                button.onclick = () => selectContract(key);
                button.innerHTML = `
                    <div class="contract-name">${contract.name}</div>
                    <div class="contract-description">${contract.description}</div>
                    <div class="contract-score">Total: ${contract.score}</div>
                `;
                grid.appendChild(button);
            }
        }
        function aiSelectContract() {
            const available = Object.keys(CONTRACTS).filter(k => 
                !gameState.usedContracts[gameState.dealer].includes(k)
            );
            if (available.length > 0) {
                const selected = available[Math.floor(Math.random() * available.length)];
                selectContract(selected);
            }
        }
        function selectContract(contractKey) {
            gameState.selectedContract = contractKey;
            gameState.usedContracts[gameState.dealer].push(contractKey);
            if (contractKey === 'TRUMPS') {
                const suits = Object.keys(SUITS);
                gameState.trumpSuit = suits[Math.floor(Math.random() * suits.length)];
            }
            gameState.bidding = {
                doubles: [false, false, false, false],
                redoubles: [false, false, false, false],
                currentBidder: (gameState.dealer + 1) % 4,
                complete: false
            };
            gameState.state = 'bidding';
            showBiddingPhase();
        }
        function showBiddingPhase() {
            hideAllSections();
            showMessage(`Contract: ${CONTRACTS[gameState.selectedContract].name} - Bidding starts`);
            const container = document.getElementById('biddingPhase');
            container.classList.remove('hidden');
            container.innerHTML = `
                <div class="contract-selection">
                    <h2 class="contract-title">Bidding Phase</h2>
                    <div class="game-info">
                        <div class="info-item">
                            <div class="info-label">Contract</div>
                            <div class="info-value">${CONTRACTS[gameState.selectedContract].name}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Dealer</div>
                            <div class="info-value">${gameState.players[gameState.dealer].name}</div>
                        </div>
                    </div>
                    <div class="bidding-status">
                        <h3 class="bidding-title">Bidding Status</h3>
                        <div class="bidding-grid" id="biddingGrid"></div>
                    </div>
                    <div id="biddingActions" class="action-buttons"></div>
                </div>
            `;
            updateBiddingDisplay();
            if (gameState.bidding.currentBidder !== 0) {
                setTimeout(() => aiBid(), 1500);
            }
        }
        function updateBiddingDisplay() {
            const grid = document.getElementById('biddingGrid');
            grid.innerHTML = '';
            for (let i = 0; i < 4; i++) {
                const div = document.createElement('div');
                div.className = 'bidder-card' + (gameState.bidding.currentBidder === i ? ' active' : '');
                let status = 'Waiting...';
                if (i === gameState.dealer) status = 'Dealer';
                else if (gameState.bidding.redoubles[i]) status = '<span style="color:#ff4444">Redoubled</span>';
                else if (gameState.bidding.doubles[i]) status = '<span style="color:#ff8844">Doubled</span>';
                div.innerHTML = `
                    <div class="bidder-name">${gameState.players[i].name}</div>
                    <div class="bidder-status">${status}</div>
                `;
                grid.appendChild(div);
            }
            const actions = document.getElementById('biddingActions');
            actions.innerHTML = '';
            if (gameState.bidding.currentBidder === 0 && !gameState.bidding.complete) {
                if (!gameState.bidding.doubles[0] && gameState.dealer !== 0) {
                    const doubleBtn = document.createElement('button');
                    doubleBtn.className = 'action-button double';
                    doubleBtn.textContent = 'Double';
                    doubleBtn.onclick = () => handleBid('double');
                    actions.appendChild(doubleBtn);
                }
                if (gameState.bidding.doubles[0] && !gameState.bidding.redoubles[0]) {
                    const redoubleBtn = document.createElement('button');
                    redoubleBtn.className = 'action-button redouble';
                    redoubleBtn.textContent = 'Redouble';
                    redoubleBtn.onclick = () => handleBid('redouble');
                    actions.appendChild(redoubleBtn);
                }
                const passBtn = document.createElement('button');
                passBtn.className = 'action-button';
                passBtn.textContent = 'Pass';
                passBtn.onclick = () => handleBid('pass');
                actions.appendChild(passBtn);
            } else if (!gameState.bidding.complete) {
                actions.innerHTML = '<p style="text-align:center;color:#f4e4a6">Waiting for other players...</p>';
            }
        }
        function handleBid(action) {
            const bidder = gameState.bidding.currentBidder;
            if (action === 'double') {
                gameState.bidding.doubles[bidder] = true;
                showMessage(`${gameState.players[bidder].name} doubles!`);
            } else if (action === 'redouble') {
                gameState.bidding.redoubles[bidder] = true;
                showMessage(`${gameState.players[bidder].name} redoubles!`);
            } else {
                showMessage(`${gameState.players[bidder].name} passes`);
            }
            const nextBidder = (bidder + 1) % 4;
            if (nextBidder === gameState.dealer) {
                completeBidding();
            } else {
                gameState.bidding.currentBidder = nextBidder;
                updateBiddingDisplay();
                if (nextBidder !== 0) {
                    setTimeout(() => aiBid(), 1000);
                }
            }
        }
        function aiBid() {
            const bidder = gameState.bidding.currentBidder;
            const canDouble = !gameState.bidding.doubles[bidder] && bidder !== gameState.dealer;
            const canRedouble = gameState.bidding.doubles[bidder] && !gameState.bidding.redoubles[bidder];
            if (canRedouble && Math.random() < 0.1) {
                handleBid('redouble');
            } else if (canDouble && Math.random() < 0.3) {
                handleBid('double');
            } else {
                handleBid('pass');
            }
        }
        function completeBidding() {
            gameState.bidding.complete = true;
            gameState.state = 'playing';
            gameState.currentPlayer = gameState.dealer;
            showMessage('Bidding complete! Game starts...');
            setTimeout(() => showGamePlay(), 2000);
        }
        function showGamePlay() {
            hideAllSections();
            document.getElementById('gamePlay').classList.remove('hidden');
            document.getElementById('gamePlay').innerHTML = `
                <div class="game-info">
                    <div class="info-item">
                        <div class="info-label">Round</div>
                        <div class="info-value">${gameState.round}/28</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Contract</div>
                        <div class="info-value">${CONTRACTS[gameState.selectedContract].name}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Trick</div>
                        <div class="info-value">${gameState.trickNumber}/13</div>
                    </div>
                </div>
                <div class="game-board">
                    <div style="grid-area: opponent2" id="player2"></div>
                    <div style="grid-area: opponent1" id="player1"></div>
                    <div class="trick-area"><div class="trick-cards" id="trickCards"></div></div>
                    <div style="grid-area: opponent3" id="player3"></div>
                    <div style="grid-area: player" id="player0"></div>
                </div>
            `;
            renderPlayers();
            showMessage(`${gameState.players[gameState.currentPlayer].name}'s turn`);
            if (gameState.currentPlayer !== 0) {
                setTimeout(() => aiPlay(), 1000);
            }
        }
        function renderPlayers() {
            for (let i = 0; i < 4; i++) {
                const container = document.getElementById(`player${i}`);
                const player = gameState.players[i];
                const isDealer = i === gameState.dealer;
                const isActive = i === gameState.currentPlayer;
                let html = `
                    <div class="player-area ${isActive ? 'active' : ''} ${isDealer ? 'dealer' : ''}">
                        <div class="player-info">
                            <div class="player-name">
                                ${player.name}
                                ${isDealer ? '<span class="dealer-badge">Dealer</span>' : ''}
                            </div>
                            <div class="player-score">${player.score}</div>
                        </div>
                        <div class="cards-container">
                `;
                for (let card of player.cards) {
                    if (i === 0) {
                        const suit = SUITS[card.suit];
                        html += `
                            <div class="card ${suit.color}" onclick="playCard('${card.id}')">
                                <div class="card-rank">${card.rank}</div>
                                <div class="card-suit">${suit.symbol}</div>
                            </div>
                        `;
                    } else {
                        html += '<div class="card-back">♠</div>';
                    }
                }
                html += '</div></div>';
                container.innerHTML = html;
            }
        }
        function playCard(cardId) {
            if (gameState.currentPlayer !== 0) return;
            const card = gameState.players[0].cards.find(c => c.id === cardId);
            if (!card) return;
            gameState.players[0].cards = gameState.players[0].cards.filter(c => c.id !== cardId);
            gameState.currentTrick.push({ player: 0, card });
            if (gameState.currentTrick.length === 4) {
                setTimeout(() => evaluateTrick(), 1500);
            } else {
                gameState.currentPlayer = (gameState.currentPlayer + 1) % 4;
                renderPlayers();
                renderTrick();
                setTimeout(() => aiPlay(), 1000);
            }
        }
        function aiPlay() {
            const player = gameState.currentPlayer;
            const hand = gameState.players[player].cards;
            if (hand.length === 0) return;
            const card = hand[Math.floor(Math.random() * hand.length)];
            gameState.players[player].cards = hand.filter(c => c.id !== card.id);
            gameState.currentTrick.push({ player, card });
            if (gameState.currentTrick.length === 4) {
                setTimeout(() => evaluateTrick(), 1500);
            } else {
                gameState.currentPlayer = (gameState.currentPlayer + 1) % 4;
                renderPlayers();
                renderTrick();
                if (gameState.currentPlayer !== 0) {
                    setTimeout(() => aiPlay(), 1000);
                }
            }
        }
        function renderTrick() {
            const container = document.getElementById('trickCards');
            container.innerHTML = '';
            for (let play of gameState.currentTrick) {
                const suit = SUITS[play.card.suit];
                const div = document.createElement('div');
                div.className = `card ${suit.color}`;
                div.innerHTML = `
                    <div class="card-rank">${play.card.rank}</div>
                    <div class="card-suit">${suit.symbol}</div>
                `;
                container.appendChild(div);
            }
        }
        function evaluateTrick() {
            const winner = gameState.currentTrick[0].player;
            gameState.players[winner].tricks++;
            gameState.trickNumber++;
            gameState.currentTrick = [];
            gameState.currentPlayer = winner;
            showMessage(`${gameState.players[winner].name} wins the trick!`);
            renderPlayers();
            renderTrick();
            if (gameState.players[0].cards.length === 0) {
                setTimeout(() => endRound(), 2000);
            } else if (winner !== 0) {
                setTimeout(() => aiPlay(), 1500);
            }
        }
        function endRound() {
            for (let i = 0; i < 4; i++) {
                let score = 0;
                if (gameState.selectedContract === 'NO_TRICKS') {
                    score = gameState.players[i].tricks * -2;
                } else if (gameState.selectedContract === 'TRUMPS') {
                    score = gameState.players[i].tricks * 5;
                }
                let mult = 1;
                if (gameState.bidding.doubles[i]) mult *= 2;
                if (gameState.bidding.redoubles[i]) mult *= 2;
                gameState.players[i].score += score * mult;
            }
            if (gameState.round === 28) {
                showGameOver();
            } else {
                gameState.round++;
                gameState.dealer = (gameState.dealer + 1) % 4;
                setTimeout(() => startRound(), 3000);
            }
        }
        function showGameOver() {
            hideAllSections();
            const modal = document.getElementById('gameOver');
            modal.classList.remove('hidden');
            const sorted = [...gameState.players].sort((a, b) => b.score - a.score);
            let table = '<table><thead><tr><th>Player</th><th>Score</th></tr></thead><tbody>';
            for (let p of sorted) {
                table += `<tr><td>${p.name}</td><td>${p.score}</td></tr>`;
            }
            table += '</tbody></table>';
            modal.innerHTML = `
                <div class="modal">
                    <h2>Game Over!</h2>
                    <div class="score-table">${table}</div>
                    <div class="action-buttons">
                        <button class="action-button" onclick="location.reload()">New Game</button>
                    </div>
                </div>
            `;
        }
        window.onload = () => {
            showMessage('Welcome to Barbu! Starting game...');
            setTimeout(() => startRound(), 1000);
        };
    </script>
</body>
</html>
